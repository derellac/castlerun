<!DOCTYPE html>
<html lang="en-US">
	<head>
	<style>
	  body {
      margin: 0px;
      background-color: black;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

	</style>
		<script>
      window.onload = playGame
      var temp
      function playGame() {
        this.canvas = document.getElementsByTagName("canvas").item(0)
        this.ctx = canvas.getContext("2d")
        this.canvas.width = window.innerWidth
        this.canvas.height = window.innerHeight
        
        this.clean = function() {
          ctx.fillStyle = "rgb(0, 0, 0)"
          ctx.fillRect(0, 0, canvas.width, canvas.height)
        }
        
        clean()
        
        function PlayingField() {
          var blocks = [];
          this.offset = 0;
          this.current_level = 0;
          function Player() {
            this.x = 0;
            this.y = 0;
            
            this.draw = function(offset) {
                raster = 20
                ctx.fillStyle = "rgb(220,220,0)"
                ctx.fillRect(canvas.width/raster*this.x, canvas.height/raster*this.y+offset*canvas.height, canvas.width/raster, canvas.height/raster)
            }
          }
          this.player = new Player();
          function Block(x,y) {
            this.row = x;
            this.column = y;
            this.color = Math.floor(Math.random() * 120)

            this.draw = function(offset) {
                raster = 20
                ctx.fillStyle = "rgba("+this.color+","+this.color+","+this.color+", .9)";
                ctx.strokeStyle = "rgba(120,220,120, .9)";
                ctx.lineWidth = 2
                ctx.beginPath();
                ctx.roundRect(canvas.width/raster*this.row, canvas.height/raster*this.column+offset*canvas.height, canvas.width/raster, canvas.height/raster,10);
                ctx.fillRect(canvas.width/raster*this.row, canvas.height/raster*this.column+offset*canvas.height, canvas.width/raster, canvas.height/raster)
                ctx.stroke();

            }
          }
          this.init_blocks = function() {
            blocks = []
            for(var i = 0; i < 200; i++) {
              raster = 20
              x = Math.floor(Math.random() * raster)
              y = Math.floor(Math.random() * raster)
              blocks.push(new Block(x,y))
            }
          }
          this.add_blocks = function(level) {
            for(var i = 0; i < 200; i++) {
              raster = 20
              x = Math.floor(Math.random() * raster)
              y = Math.floor(Math.random() * raster)-level*raster
              blocks.push(new Block(x,y))
            }
          }
          this.draw_blocks = function() {
            blocks.forEach(block => block.draw(this.offset));
          }
          this.draw_field = function() {
            this.draw_blocks()
            this.player.draw(this.offset)
          }
          this.refresh = function() {
            clean()
            this.draw_field()
          }
          this.update_offset = function() {
            this.offset = this.offset + 0.002 + this.current_level/1000
            if (this.offset > this.current_level) {
              this.current_level = this.current_level + 1
              this.add_blocks(this.current_level)
            }
          }
          
          this.start_moving = function() {
            setInterval(this.refresh.bind(this),100)
            setInterval(this.update_offset.bind(this),100)
          
          }
          
          this.move_player = function(key) {
            if (key.keyCode == '37') {
               this.player.x-=1
            }
            if (key.keyCode == '38') {
                this.player.y-=1
            }
            if (key.keyCode == '39') {
               this.player.x+=1
            }
            if (key.keyCode == '40') {
                this.player.y+=1
            }
          
          }
          document.onkeydown = this.move_player.bind(this);
        
        }
        
        t = new PlayingField()
        
        t.init_blocks()
        t.draw_blocks()        
        t.start_moving()

      }
      
    </script>
 		<meta charset="utf-8" />
 		<title>Castle Run</title>
 	</head>
  	<body>
		 <canvas width="800" height="600"></canvas>
    
 	</body>
</html>

